<!doctype html>
<html>
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>History — CircuitGuard AI</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  body{
    font-family:Inter,Arial;
    background:#07102a;
    color:#e6f7ff;
    padding:20px;
  }
  h2{
    text-align:center;
    color:#00c6ff;
    margin-bottom:20px;
  }
  .back-btn{
    display:inline-block;
    padding:10px 16px;
    background:#00c6ff;
    color:#02122a;
    border-radius:10px;
    text-decoration:none;
    font-weight:700;
    margin-bottom:18px;
    transition:0.2s;
  }
  .back-btn:hover{ background:#14d0ff; }
  .card{
    background:rgba(255,255,255,0.02);
    padding:14px;
    border-radius:10px;
    margin-bottom:12px;
    border:1px solid rgba(0,198,255,0.06)
  }
  a.btn{
    padding:8px 10px;
    background:#00c6ff;
    color:#02122a;
    border-radius:8px;
    text-decoration:none;
    margin-right:6px;
  }
  a.btn:hover{ background:#14d0ff; }
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,0.04);text-align:left}
  th{color:#9ec9ff;}
</style>
</head>
<body>
  <a href="/" class="back-btn">⬅ Back to Home</a>

  <h2>Run History</h2>
  <div class="card">
    <table id="histTbl">
      <thead>
        <tr><th>Time</th><th>Report ID</th><th>Total</th><th>Avg Conf</th><th>Actions</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
<script>
  async function loadHistory(){
    try{
      const r = await fetch("/api/history?limit=50");
      if(!r.ok) throw new Error("API error");
      const d = await r.json();
      const tbody = document.querySelector("#histTbl tbody");
      tbody.innerHTML = "";
      (d.runs||[]).forEach(run=>{
        const tr=document.createElement("tr");
        const id=run.report_id;
        const pdf = run.files?.pdf;
        const total = run.stats?.total ?? 0;
        const avg = (run.stats?.avg_conf ?? 0)*100;
        tr.innerHTML = `<td>${run.created_at||""}</td>
          <td>${id}</td>
          <td>${total}</td>
          <td>${avg.toFixed(1)}%</td>
          <td>
            <a class="btn" href="/view-image/${id}/annotated" target="_blank">Open</a>
            <a class="btn" href="/download-image/${id}/annotated">Ann</a>
            <a class="btn" href="/download-image/${id}/diff">Diff</a>
            <a class="btn" href="/download-image/${id}/mask">Mask</a>
            ${pdf? `<a class="btn" href="/download-pdf/${pdf}">PDF</a>` : ""}
            <a class="btn" href="/download-csv/${id}">CSV</a>
          </td>`;
        tbody.appendChild(tr);
      });
    }catch(e){
      console.error(e);
      alert("Failed to load history: "+e.message);
    }
  }
  window.addEventListener("load", loadHistory);
</script>
</body>
</html>
